---
mode: agent
description: 先理解需求並整理成 EARS 列表，為後續 BDD --> SDD --> TDD Prompt 提供完整輸入
inputs:
  summary: 使用 Prompt 釐清使用者需求
  required:
    - 直接對話進行釐清
    - 提供會議記錄、文件、`README.md`、GitHub Issue Number 等相關資訊
outputs:
  summary: 以使用者情境為主，整理可追蹤的需求摘要，準備交由 BDD 進一步展開（非技術實作細節）
  include:
    - 輸出 EARS 清單（純以使用者情境與行為為主；絕對不得包含技術、API、資料模型或實作細節）
    - 建議接手的 Prompt（預設 `bdd.prompt.md`）；若出現技術或 SDD 議題，請標註並轉給 `tech-stack.prompt.md` / `sdd.prompt.md`
---

# 需求分析

## 目的

以不斷提問的方式去釐清需求，並使用 EARS 語法整理需求，方便後續對齊 BDD --> SDD --> TDD 的實作流程

## 提問原則

- 採「單一問題 + 選項 + 自訂輸入」格式，便於使用者快速回覆
- 每題最多 4 個選項，預留「⑤ 其他／自行輸入」

### 常用問題題庫

```
- 是否為全新的一份專案？
  ① 是
  ② 否
- 目標使用者是誰？
  ① 內部員工  ② 一般消費者  ③ 企業客戶  ④ 其他（請說明）
- 此需求屬於？
  ① 新功能  ② 修改現有功能  ③ 修正 bug  ④ 研究/探索
- 關鍵成功指標（KPI）為何？
  ① 使用率提升  ② 錯誤率下降  ③ 成本降低  ④ 其他（請說明）
- 是否有時間或發佈時程限制？
  ① 必須在 X 週內  ② 有季度限制  ③ 無嚴格期限  ④ 需協調其他團隊
- 是否涉及敏感資料或合規（例如 PII）？
  ① 是  ② 否  ③ 不確定（需確認）  ④ 其他（請說明）
- 目前主要聚焦的領域是？
  ① API / 後端服務
  ② 前端或 UI 互動
  ③ 資料處理 / ETL / ML 訓練
  ④ CI/CD、Infra
  ⑤ 其他（請說明）
```

## 操作流程

### Step 1：確認狀態

1. 閱讀使用者提供的文件（如：`README.md`、`CHANGELOG.md`、GitHub Issue 等），了解近期變更與程式邏輯
2. 檢查是否已有 EARS 需求 Issue。若有，請根據原本的 Issue 進行修改

### Step 2：補齊需求

1. 發現需求的不一致、缺漏
2. 藉由不斷提問，釐清使用者的需求

#### 升級／轉交規則
- 若需求包含架構設計、API 規格或需要明確資料模型，請標註 `needs-sdd` 並轉交 `sdd.prompt.md`。
- 若需求涉及第三方套件選型、成本估算或技術可行性評估，請標註 `needs-tech` 並轉交 `tech-stack.prompt.md`。
- 若需求包含安全、合規或資料治理議題，請標註並同時通知安全或法遵負責人。

### Step 3：整理輸出

1. EARS 句法有固定句式，選擇不同的語句會產生不同的需求表達，應依場景選用合適模式以清晰呈現需求
2. 根據對話以及文件，使用 `.github/ISSUE_TEMPLATE/ears.yaml` 建立 EARS Issue，Issue 標題格式：`[EARS] <短標題>`
3. 並根據類型排列 EARS 列表

#### EARS 範例與語法

以下為 EARS 常見模式、語法範本：

1. 通用性需求（Givens / Universal Requirements）
   - 含義：系統在運行過程中始終需滿足的需求，不受特定事件或輸入驅動。
   - 模板：<系統/物件> 應該 <行為/屬性>
   - 範例：手機的質量應該小於 XX 克。

2. 狀態驅動需求（State-driven / WHILE）
   - 含義：在某個系統狀態下持續為真、始終保持的需求。
   - 關鍵字：WHILE / 在...情況下
   - 模板：在 <狀態> 情況下，<系統> 應該 <行為>
   - 範例：在飛機處於飛行狀態且發動機運轉的情況下，控制系統應保持發動機燃油流量高於 XX 磅/秒。

3. 事件驅動需求（Event-driven / WHEN）
   - 含義：描述系統在特定事件發生時應如何回應。
   - 關鍵字：當...時 / WHEN
   - 模板：當 <事件> 時，<系統> 應該 <行為>
   - 範例：當飛行器發出連續點火指令時，控制系統應啟動連續點火程序。

4. 可選功能需求（Optional / CONDITION）
   - 含義：僅在特定可選特性啟用或特定配置下適用的需求。
   - 關鍵字：在...條件下 / IF CONFIGURED
   - 模板：在 <條件/配置> 下，<系統> 應該 <行為>
   - 範例：在控制系統啟用超速保護功能的情況下，在飛機起飛前，控制系統應測試超速保護功能的有效性。

5. 異常行為需求（Error / Exception handling）
   - 含義：描述系統在異常或錯誤條件下應如何運作、恢復或通知。
   - 關鍵字：如果...，那麼... / IF... THEN...
   - 模板：如果 <異常條件>，那麼 <系統> 應該 <行為>
   - 範例：如果計算空速不可用，那麼控制系統應使用模型空速作為替代值。

6. 複合需求（Composite / Combined Preconditions + Event）
   - 含義：當某個事件的觸發需先滿足一組或多組先決條件時，使用複合句式來表達。
   - 模板（期望行為）：在 <先決條件> 情況下，當 <事件> 時，<系統> 應該 <行為>
   - 模板（異常行為）：在 <先決條件> 情況下，當 <事件> 時，如果 <異常條件>，那麼 <系統> 應該 <行為>
   - 範例：當飛機位於地面並收到反推力指令時，控制系統應啟動反推力裝置。

> 注意：EARS 僅描述使用者與系統在業務情境下的行為與期望；切勿在 EARS 中包含任何技術或實作細節（例如 API 規格、資料模型、部署方式或程式碼）。若在釐清過程出現技術議題，請標註並轉交至 `sdd.prompt.md` 或 `tech-stack.prompt.md`。

## 後續行動

- 下一個預計執行的 Prompt（預設 `bdd.prompt.md`）
